
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../installation/">
      
      
        <link rel="next" href="../NextflowPipeline/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Tutorial - ZipStrain</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ZipStrain" class="md-header__button md-logo" aria-label="ZipStrain" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZipStrain
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ZipStrain" class="md-nav__button md-logo" aria-label="ZipStrain" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ZipStrain
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to ZipStrain
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-zipstrain" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to ZipStrain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to ZipStrain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mapping-reads" class="md-nav__link">
    <span class="md-ellipsis">
      Mapping Reads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Generating Profiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generating Profiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zipstrain-cli" class="md-nav__link">
    <span class="md-ellipsis">
      ZipStrain CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nextflow-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Nextflow Pipeline
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-genomes-in-multiple-profiled-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Compare genomes in multiple profiled samples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compare genomes in multiple profiled samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zipstrain-cli_1" class="md-nav__link">
    <span class="md-ellipsis">
      ZipStrain CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nextflow-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Nextflow Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-files" class="md-nav__link">
    <span class="md-ellipsis">
      Output files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downstream-analyses" class="md-nav__link">
    <span class="md-ellipsis">
      Downstream Analyses
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Downstream Analyses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strain-sharing-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Strain Sharing Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recommended-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Recommended Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recommended Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-a-centralized-database-for-your-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      1- Create a centralized database for your profiles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../NextflowPipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nextflow Pipeline for ZipStrain
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ZipStrain Command Line Interface
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-zipstrain" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to ZipStrain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to ZipStrain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mapping-reads" class="md-nav__link">
    <span class="md-ellipsis">
      Mapping Reads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Generating Profiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generating Profiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zipstrain-cli" class="md-nav__link">
    <span class="md-ellipsis">
      ZipStrain CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nextflow-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Nextflow Pipeline
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-genomes-in-multiple-profiled-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Compare genomes in multiple profiled samples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compare genomes in multiple profiled samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zipstrain-cli_1" class="md-nav__link">
    <span class="md-ellipsis">
      ZipStrain CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nextflow-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Nextflow Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-files" class="md-nav__link">
    <span class="md-ellipsis">
      Output files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downstream-analyses" class="md-nav__link">
    <span class="md-ellipsis">
      Downstream Analyses
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Downstream Analyses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strain-sharing-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Strain Sharing Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recommended-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Recommended Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recommended Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-a-centralized-database-for-your-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      1- Create a centralized database for your profiles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="tutorial">Tutorial</h1>
<p>This tutorial will guide you through the basics of using ZipStrain.</p>
<h2 id="introduction-to-zipstrain">Introduction to ZipStrain</h2>
<p>ZipStrain is a tool for profiling a metagenomics sample against a database of reference genomes and performing comparisons between the profiles as well as downstream analyses. </p>
<p>The typical workflow consists of the following steps:</p>
<p>1- Mapping reads to a reference database using any read mapper of your choice (e.g., BWA, Bowtie2, Minimap2).</p>
<p>2- Generating a profile from the mapped reads using ZipStrain. This step will generate a parquet file containing nucleotide frequencies for all positions in the reference genomes.</p>
<p>3- Comparing the generated profiles against each other and/or against a reference profile.</p>
<p>4- Performing downstream analyses, such as Identity-By-State (IBS), StrainSharing, and clustering.</p>
<h3 id="mapping-reads">Mapping Reads</h3>
<p>In this step, you will map your metagenomics reads to a reference database using a read mapper of your choice. The reference database is a concatenation of all reference genomes you want to profile against. The output of this step should be a BAM file. It is recommended to discard unmapped reads to reduce file size. Currently, you can use the nextflow pipeline accompanying ZipStrain to perform this step with Bowtie2. Here is an example command using Bowtie2, but for more information about the nextflow pipeline, please refer to the <a href="../NextflowPipeline/">Nextflow Pipeline Documentation</a>.</p>
<pre><code>
nextflow run zipstrain.nf --mode 'map_reads' --input_type 'sra|local' --input_table 'path/to/your/input_table.tsv' --reference_genome &lt;path/to/your/reference_db.fasta&gt; --output_dir &lt;path/to/your/output_dir&gt; -c conf.config -profile &lt;your_profile&gt; -resume

</code></pre>
<p>NOTE: map_reads mode can work with either SRA accessions or local FASTQ files. Please refer to the Nextflow Pipeline Documentation for more details.</p>
<p>This step will generate BAM files for each of your samples in the specified output directory.</p>
<h3 id="generating-profiles">Generating Profiles</h3>
<p>In this step, you will generate profiles from the mapped reads using ZipStrain. A profile is simply a table in parquet format that contains the 
following columns:</p>
<pre><code>
|chrom|pos|gene|A|C|G|T|

</code></pre>
<p>Where <code>chrom</code> is the scaffold, <code>pos</code> is the position in the reference genome, <code>gene</code> is the gene name (if a gene file is provided), and <code>A</code>, <code>C</code>, <code>G</code>, and <code>T</code> are the counts of each nucleotide at that position based on the mapped reads.</p>
<p>The information will be generated for every position in the reference genomes that has at least one read mapped to it. There are two ways to generate profiles using ZipStrain: </p>
<ul>
<li>
<p>ZipStrain as a command-line tool</p>
</li>
<li>
<p>ZipStrain Nextflow pipeline.</p>
</li>
</ul>
<p>You can profile multiple BAM files using either the ZipStrain command-line interface (CLI) or Nextflow Pipeline. Below are examples of both methods.
For both you need to prepare a csv file containing the paths to the bam files to be profiled and the sample names. Example of such a csv file:</p>
<pre><code class="language-csv">sample_name,bamfile
sample1,/path/to/sample1.bam
sample2,/path/to/sample2.bam
sample3,/path/to/sample3.bam
</code></pre>
<h4 id="zipstrain-cli">ZipStrain CLI</h4>
<p>To profile multiple BAM files using the ZipStrain CLI, you should first prepare some files:</p>
<pre><code class="language-bash">zipstrain run prepare-profiling  --reference-fasta &lt;path/to/reference/fasta&gt; --gene-fasta &lt;path/to/reference/fasta/genes&gt; --stb-file  &lt;path/to/stb/file&gt; --output-dir &lt;directory/to/save/outputs&gt;
</code></pre>
<p>Your output directory should contain the following files:</p>
<ul>
<li>genomes_bed_file.bed</li>
<li>genome_lengths.parquet</li>
<li>gene_range_table.tsv</li>
</ul>
<p>Now you can profile your bam files:</p>
<pre><code>zipstrain run profile --input-table &lt;path/to/bam/csv&gt; --stb-file &lt;path/to/stb/file&gt; --gene-range-table &lt;path/to/gene/range&gt; --bed-file &lt;path/to/bed/file&gt; --genome-length-file &lt;path/to/bed/file&gt; --run-dir &lt;path/to/save/generated/files&gt;

</code></pre>
<h4 id="nextflow-pipeline">Nextflow Pipeline</h4>
<p>To profile multiple BAM files using Nextflow, you can create a Nextflow script as follows:</p>
<pre><code>
nextflow run zipstrain.nf --mode &quot;fast_profile&quot; --input_table &lt;path/to/bam/csv&gt;  --gene_file &lt;path/to/reference/fasta/genes&gt; --stb &lt;path/to/stb/file&gt;  --output_dir &lt;path/to/save/generated/files&gt; --reference_genome &lt;path/to/reference/fasta&gt; -c conf.config -profile &lt;your/system/specific/profile&gt; -resume

</code></pre>
<p><strong>Note</strong>  With the nextflow pipeline, you don't need the preparation step and those will be made along the way.</p>
<p><strong>Note</strong> fast_profile mode requires a gene file and a STB file. The gene file MUST BE following Prodigal NUCLEOTIDE format. For generating STB file, use the following command:</p>
<p><code>zipstrain utilities generate_stb --genomes-dir-file &lt;path/to/genomes_dir_file&gt;</code></p>
<p>If you have trouble generating the STB file, you can simply make one using a custom script. The STB file is a tab-separated file with two columns: scaffold name and genome file name. </p>
<h3 id="compare-genomes-in-multiple-profiled-samples">Compare genomes in multiple profiled samples</h3>
<p>You can compare multiple profiled samples using either the ZipStrain command-line interface (CLI) or Nextflow Pipeline. Below are examples of both methods. The two approaches are slightly different in terms of input requirements. First let's see how this is done using the ZipStrain CLI.</p>
<h4 id="zipstrain-cli_1">ZipStrain CLI</h4>
<p>To compare multiple profiled samples using the ZipStrain CLI, first you need to build a profile database that contains all the profiled samples you want to compare. You can do this by running the following command:</p>
<pre><code class="language-bash">zipstrain utilities build-profile-db --profile-db-csv &lt;path/to/profiles/csv&gt; --output-db &lt;path/to/save/profile/db&gt;
</code></pre>
<p>The input CSV file should have the following columns:</p>
<pre><code>- profile_name: An arbitrary name given to the profile (Usually sample name or name of the parquet file)

- profile_location: The location of the profile

- scaffold_location: The location of the scaffold

- reference_db_id: The ID of the reference database. This could be the name or any other identifier for the database that the reads are mapped to.

- gene_db_id: The ID of the gene database in fasta format. This could be the name or any other identifier for the database that the reads are mapped to.
</code></pre>
<p>Running this command will perform the necessary checks and if successful, it will create a profile database in parquet format at the specified output location.</p>
<p>Next, You use this profile database build a configuration json file that will be used to calculate the pairs that need to be compared. In this step you need to define the required parameters for comparison such as min_coverage, etc. You can make the configuration file by running the following command:</p>
<pre><code class="language-bash">zipstrain utilities build-comparison-config \
--profile-db &lt;path/to/profile/db&gt; \
--gene-db-id &lt;gene_db_id_used_in_profile_db&gt; \
--reference-db-id &lt;reference_db_id_used_in_profile_db&gt; \
--scope &quot;all&quot; \
--min-cov 5 \
--min-gene-compare-len 200 \
--null-model-p-value 0.05 \
--stb-file-loc &lt;path/to/stb/file&gt; \
--null-model-loc &lt;path/to/null/model/file&gt; \
--current-comp-table &lt;path/to/current/comparison/table.parquet&gt; \
--output-file &lt;path/to/save/comparison/config.json&gt;
</code></pre>
<p>Note that providing current-comp-table is optional. If provided, the comparison config will only include pairs that are not already compared in the current comparison table.</p>
<p>Finally, you can run the comparison using the generated configuration file and the profile database:</p>
<pre><code class="language-bash">zipstrain run compare_genomes \
--genome-comparison-object &lt;path/to/comparison/config.json&gt; \
--run-dir &lt;path/to/save/comparison/outputs&gt; \
--max-concurrent-batches 1
</code></pre>
<h4 id="nextflow-workflow">Nextflow Workflow</h4>
<p>There are two ways you can run the comparison workflow in ZipStrain Nextflow pipeline. </p>
<p>1- I have a comparison config file already made using the ZipStrain CLI as explained above.</p>
<p>In this case you obtain a table of remaining pairs to be compared from the comparison config file and run the comparison as follows:</p>
<pre><code>zipstrain utilities to-complete-table --genome-comparison-object &lt;path/to/comparison/config.json&gt; --output-file &lt;path/to/output/remaining_pairs.csv&gt;
</code></pre>
<p>Then you can run the comparison using the following command:</p>
<pre><code>nextflow run zipstrain.nf --mode fast_compare \
 --input_table &lt;path/to/output/remaining_pairs.csv&gt; \
 --input_type &quot;pair_table&quot; --gene_file &lt;path/to/gene/fasta/file&gt; \
 --reference_genome &lt;path/to/reference/genome.fasta&gt; \  
 --stb &lt;path/to/stb/file.stb&gt; -c conf.config \
 --output_dir &quot;&lt;path/to/output/directory&gt;&quot; \
 --compare_genome_scope &quot;all&quot; \
 --compare_memory_mode &quot;heavy&quot; \
 --parallel_mode &quot;batched&quot; \
 --batch_size 2000 -profile &lt;profile_name&gt; \
 --batch_compare_n_parallel 3 -qs 200 -resume
</code></pre>
<p>2- I don't have a comparison config file and I want to run the comparison directly from the profile lists.</p>
<p>In this case, the nextflow pipeline will run all non-redundant pairwise comparisons between the provided profiles. Here is an example command:</p>
<pre><code>nextflow run zipstrain.nf --mode fast_compare \
 --input_table &lt;path/to/profiles/csv&gt; \
 --input_type &quot;profile_table&quot; --gene_file &lt;path/to/gene/fasta/file&gt; \
 --reference_genome &lt;path/to/reference/genome.fasta&gt; \
 --stb &lt;path/to/stb/file.stb&gt; -c conf.config \
 --output_dir &quot;&lt;path/to/output/directory&gt;&quot; \
 --compare_genome_scope &quot;all&quot; \
 --compare_memory_mode &quot;heavy&quot; \
 --parallel_mode &quot;batched&quot; \
 --batch_size 2000 -profile &lt;profile_name&gt; \
 --batch_compare_n_parallel 3 -qs 200 -resume
</code></pre>
<p>For more information, refer to the <a href="../NextflowPipeline/">Nextflow Pipeline Documentation</a>.</p>
<h4 id="output-files">Output files</h4>
<p>Regardless of the execution workflow (ZipStrain CLI or Nextflow), comparing profiles yields a single table "merged_comparison.parquet" that contains the comparison results for all compared profile pairs. The table has the following columns:</p>
<table>
<thead>
<tr>
<th>genome</th>
<th>total_positions</th>
<th>share_allele_pos</th>
<th>genome_pop_ani</th>
<th>max_consecutive_length</th>
<th>shared_genes_count</th>
<th>identical_gene_count</th>
<th>perc_id_genes</th>
<th>sample_1</th>
<th>sample_2</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="downstream-analyses">Downstream Analyses</h3>
<p>In this step, you can use the perform statiscal analyses on the comparison results generated in the previous step and visualize them using ZipStrain's Python API. All of the functionalities in the visualization module are explained below:</p>
<h4 id="strain-sharing-analysis">Strain Sharing Analysis</h4>
<p>Definition of strain sharing is somewhat losely defined in the literature. In ZipStrain, we use the following steps to define strainsharing:</p>
<ul>
<li>
<p>For each genome in the reference fasta for which the profiling is done, popANI is calculated between each pair of samples in the comparison step.</p>
</li>
<li>
<p>If the popANI between two samples for a given genome is above a certain threshold (default: 99.9%), and the breadth of coverage for that genome in both samples is above a certain threshold (default: 0.5), then the two samples are considered to share a strain for that genome.</p>
</li>
<li>
<p>The strain sharing is checked for all genomes in the reference fasta.</p>
</li>
<li>
<p>Each sample is mapped to a group using a sample to population mapping file provided by the user (See the example below). </p>
</li>
<li>
<p>Finally, the strain sharing between group A,B is calculated as the number of genome strains shared between samples in group A and samples in group B divided by the total number of genomes in group A. As a result the order of the groups matters here. The main justification for this definition is that in many cases this ordering is biologically relevant. For example, when looking at mother-infant pairs, if only 3 genomes are present in infants, but 100 genomes are present in mothers, and they share all 3 genomes in the infants, we would like to see that the infants have 100% of their strains shared with mothers, while mothers only have 3% of their strains shared with infants.</p>
</li>
</ul>
<h3 id="recommended-workflow">Recommended Workflow</h3>
<p>ZipStrain's Python API provides functionalities needed to create and organize your profiles and comparisons tables. It is highly recommended to use this workflow to manage your profiles and comparisons if you plan to use ZipStrain for multiple studies to utilize the full potential of ZipStrain. Here is a recommended workflow:</p>
<h4 id="1-create-a-centralized-database-for-your-profiles">1- Create a centralized database for your profiles</h4>
<p>Database module in ZipStrain provides functionalities to create and manage a centralized database for your profiles. The easiest way to create a profile database is to provide a CSV file that has necessary information about each profile. Your CSV file should have the following columns (and only these columns):</p>
<ul>
<li>
<p>profile_name: An arbitrary name given to the profile (Usually sample name or name of the parquet file)</p>
</li>
<li>
<p>profile_location: The location of the profile in parquet format. This is the main parquet file generated during the profiling step.</p>
</li>
<li>
<p>scaffold_location: The location of the scaffold file in TSV format that is generated during the profiling step. This file basically contains any scaffold names present in the reference database which have at least one read mapped to them in the sample.</p>
</li>
<li>
<p>reference_db_id: The ID of the reference database. This could be the name or any other identifier for the database that the reads are mapped to. Could be used for filtering profiles based on reference database later on.</p>
</li>
<li>
<p>gene_db_id: The ID of the gene database in fasta format. This could be the name or any other identifier of your choice for the database that the reads are mapped to. Could be used for filtering profiles based on gene database later on.</p>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>